var zmFriendRequests=(function(){var D;var l;var C,G,B,j,n,m,o=0,v,t,F=false;function A(a){if(zm.trim(a)==""){if(B){clearTimeout(B)}zm.Boxy.alert("Vui lòng nhập nội dung tin nhắn!","Thông báo",2000,{okButton:"Đóng",beforeHide:function(){zm("#makefriendrq_msg").focus()}});return false}else{return true}}var H=zmConfig.FRIEND_URL+"/act/sendreq?",y=zmConfig.FRIEND_URL+"/widget/topreq",z=zmConfig.FRIEND_URL+"/act/acceptreq?",w=zmConfig.FRIEND_URL+"/act/rejectreq?";function x(){var a=zm("#frlist"),b=a.children();if(b.size()>1){zm(b[0]).addClass("zme-notify-item-first")}else{a.prepend('<p class="notif_noitem">Bạn không có lời mời kết bạn nào mới</p>')}p()}function s(){zm.getJSON(zmConfig.FRIEND_URL+"/rq/list?cb=?",function(e){var d=e.list,b="";for(var a=0,c;c=d[a];a++){b+=r(c)}zm("#frReq_all").html(b);zm("#frReq_all_more")[e.more?"show":"hide"]();zwg.fillWg();n.show();o=20})}function r(d){var c=d.uid,a=d.uname,e=d.msg.replace(/</g,"&lt;").replace(/>/g,"&gt;"),b='<div id="frReq_row_'+c+'" class="row line"><input type="checkbox" class="checkbox checkBR" value="'+c+'"><div class="maincont"><span id="freq_avatar_'+c+'" class="avatar"></span><div class="cont"><div class="name"><span id="freq_name_'+c+'"></span></div><p class="grey"><span>Nơi ở:<strong>'+d.address+'</strong></span><span class="pad5">|</span><span>Giới tính:<strong>'+d.sex+'</strong></span><span class="pad5">|</span><span>Tuổi:<strong>'+d.age+'</strong></span></p><p class="mt8">'+e+'</p><div class="btn mt8 fl"><a href="#" class="btn_L3" onclick="zmFriendRequests.acceptButtonClick(this, '+c+');return false;"><em>Đồng ý</em></a><a href="#" class="btn_L5" onclick="zmFriendRequests.rejectButtonClick(this, '+c+');return false;"><em>Từ chối</em></a></div></div><div class="clr"></div></div><div class="link-rig"><a href="/fr/'+a+"/ownerf/mutual?uid="+c+'" onmouseover="zmFriendRequests.showTotalMutual(this, '+c+');" onmouseout="zmFriendRequests.hideTotalMutual();">Bạn chung</a><span class="pad5">|</span><a href="/fr/'+a+'/ownerf">Danh sách bạn</a></div><div class="clr"></div></div>';zwg.addItem("freq_avatar_"+c,"ZMEA_"+c+"?id=1&size=120&width=120&height=120&l=1");zwg.addItem("freq_name_"+c,"ZMED_"+c+"?id=1&l=1");return b}function q(b){t=b;var a=zm("#frReq_all_more");a.children("img")[b?"show":"hide"]();a.children("a")[b?"hide":"show"]()}function u(){if(t){return}q(true);j>0&&zm.getJSON(zmConfig.FRIEND_URL+"/widget/request/list?offset="+o+"&cb=?",function(e){var d=e.list,b="";for(var a=0,c;c=d[a];a++){b+=r(c)}zm("#frReq_all").append(b);q(false);zwg.fillWg();o+=20})}function k(){var b=this.nodeName.toLowerCase()=="input",a=this.checked;if(!b){a=this.id=="frReq_ckall";zm("#frReq_ickall").attr("checked",a)}zm("#frReq_all input.checkbox").attr("checked",a);return b}function E(){var a=[];zm("#frReq_all input.checkbox").each(function(){if(this.checked){a.push(this.value)}});if(a.length==0){zm.Boxy.alert("Vui lòng chọn lời mời để xóa","Thông báo",2000)}else{zm.Boxy.confirm("Bạn có muốn xóa "+(a.length==1?"":"những ")+"lời mời kết bạn này không?",function(){zm.getJSON(zmConfig.FRIEND_URL+"/act/rejectmulreq?friends="+a.join(","),function(d){if(d.error==0){for(var c=0,b;b=a[c];c++){zm("#frReq_row_"+b).remove()}j-=a.length;p();zm("#frReq_ickall").attr("checked",false)}else{zm.Boxy.alert("Có lồi xảy ra, vui lòng thử lại sau.","Thông báo",3000)}})},{title:"Thông báo",okButton:"Xóa",cancelButton:"Bỏ qua"})}return false}function p(){j>=0&&zm("#frtotal").html("("+j+")");if(n&&n.isShowing()){if(j==0){n.hide()}j>=0&&n.setTitle("Lời mời kết bạn ("+j+")");if(zm("#frReq_all").children().size()<5){u()}}}return{send:function(b,e,c){var d=H+"userid_to="+b;if(c){for(var a in c){d=d+"&"+a.toString()+"="+c[a]}}zm.getJSON(d,function(f){var h="";switch(f.error){case 0:if(C instanceof zm.Boxy){C.hide()}if(c.suc_not==false){break}zm.Boxy.alert("Yêu cầu đã được gửi thành công","Thông báo",3000,{okButton:"Đóng"});break;case 2:if(C instanceof zm.Boxy){C.hide()}zm.Boxy.alert("Hai người đã là bạn của nhau từ trước","Thông báo",3000,{okButton:"Đóng"});break;case 3:if(C instanceof zm.Boxy){C.hide()}h="frReqMsg3-"+b;zm.Boxy.alert("<div id='"+h+"'>Bạn đã gửi yêu cầu kết bạn đến <span id=\"msgsuc_"+b+'" ></span> và đang chờ đồng ý</div>',"Thông báo",10000,{okButton:"Đóng"});try{zwg.addItem("msgsuc_"+b,"ZMED_"+b+"?id=1&l=3");zwg.fillWg()}catch(g){}break;case 4:if(C instanceof zm.Boxy){C.hide()}h="frReqMsg4-"+b;zm.Boxy.alert("<div id='"+h+"'><strong><span id=\"msgsuc_"+b+"\" ></span></strong> đã gửi yêu cầu kết bạn đến bạn, bạn hãy nhấn <a onClick='zmFriendRequests.acceptFriendRequest("+b+")'> vào đây </a> để đồng ý</div>","Thông báo",20000,{okButton:"Đóng"});try{zwg.addItem("msgsuc_"+b,"ZMED_"+b+"?id=1&l=3");zwg.fillWg()}catch(g){}break;case 7:if(C instanceof zm.Boxy){C.hide()}zm.Boxy.alert('Danh sách bạn bè của bạn đã đầy. Hãy xóa 1 trong những người bạn của bạn để có thể tiếp tục kết bạn. <a target="_parent" href='+zmConfig.ME_URL+"/fr/"+zmConfig.viewerName+"/index/list?_src=m> Đến trang bạn bè</a>","Thông báo",10000,{okButton:"Đóng"});break;case 8:if(C instanceof zm.Boxy){C.hide()}zm.Boxy.alert("Không thể gửi quá 100 lời mời kết bạn trong một ngày","Thông báo",4000,{okButton:"Đóng"});break;case 9:if(C instanceof zm.Boxy){C.hide()}zmFriendRequests.updateAvatar(f,b);default:if(C instanceof zm.Boxy){C.hide()}break}typeof e==="function"&&e(f,b)})},accept:function(b,a){var c=z+"fromid="+b;zm.getJSON(c,function(e){var d,g="frReqErrMsg-"+b;switch(e.error){case 0:case 3:d="Kết bạn thành công";break;case 4:d="Danh sách bạn bè của người này đã đầy";break;case 5:d="Danh sách bạn bè của bạn đã đầy";break;default:d="Có lỗi xảy ra!";break}typeof a==="function"&&a(d,b,e.error);try{ZMEW_widget_mix(g)}catch(f){}})},reject:function(b,a){var c=w+"fromid="+b;zm.getJSON(c,function(){typeof a==="function"&&a()})},getTopRequests:function(a){zm.getJSON(y,function(b){var d="",c=0;zm.each(b.list,function(){var f="nfra_"+this.id,e="nfrd_"+this.id;d+='<div class="zme_notify"><span id="'+f+'" class="img"></span><div class="zme-notify-item-cont"><p class="zme-notify-fr-name"><strong><span id="'+e+'"></span></strong></p>';if(this.content){d+='<p class="notif_invite_msg">'+this.content+"</p>"}d+='<div class="fr_msg"><a href="#" class="btn_L5 fr deny_btn" id="frRqRj-'+this.id+'" onclick="zmFriendRequests.rejectButtonClick(this, '+this.id+');return false;"><em>Từ chối</em></a><a href="#" class="btn_L3 fr accept_btn" id="frRqAcp-'+this.id+'" onclick="zmFriendRequests.acceptButtonClick(this, '+this.id+');return false;"><em>Đồng ý</em></a><p class="zme-notify-time">'+(this.time?zm.formatDateTime(zm.intval(this.time)):"")+'</p><div class="clr"></div></div></div><div class="clr"></div></div>';c++;zwg.addWgItem(new wgItem(f,"ZMEA_"+this.id+"?id=1&l=1&size=50&width=42&height=42&m=1"));zwg.addWgItem(new wgItem(e,"ZMED_"+this.id+"?id=1&l=3&m=1"))});if(c!=0){d+='<div class="zme-notify-bottom"><a class="btn_L3 fr" href="#" onclick="zmNotifications.toggle(\'fr\');return false;"><em>Đóng</em></a><p class="notif_bot_left fl"><strong class="lk_bullet">.</strong><a href="'+zmConfig.BASE_URL+"fr/"+(zmConfig.viewerName+"/index/requestlist?_src=m")+'" id="frViewAll">Xem tất cả</a><strong class="lk_bullet">.</strong><a href="'+zmConfig.BASE_URL+'fr/invite" id="frInviteLink">Tìm kiếm thêm bạn bè</a></p></div>'}else{d+='<p class="notif_noitem">Bạn không có lời mời kết bạn nào</p><div class="zme-notify-bottom"><a href="#" class="btn_L3 fr" onclick="zmNotifications.toggle(\'fr\');return false;"><em>Đóng</em></a><p class="notif_bot_left fl"><a id="frInviteLink" href="/fr/invite">Tìm kiếm thêm bạn bè</a></p></div>'}b.total&&zm("#frtotal").html("("+b.total+")");j=b.total;typeof a==="function"&&a(d);zm("#frViewAll").click(function(){zmFriendRequests.showFriendRequests();return false},-10);F=true})},acceptButtonClick:function(b,c){var a;if(n&&n.isShowing()){a=zm("#frReq_row_"+c);zm(b).parent().html('<img src="'+zmConfig.IMAGE_URL+'/v3/images/loading_small.gif" />')}else{a=zm(b).parents(".zme_notify");a.empty().addClass("reqLoading")}this.accept(c,function(e,f,d){if(d!=0&&d!=3){zm.Boxy.alert("<div>"+e+"</div>","Thông báo",10000,"Đóng")}j--;a.remove();x()})},rejectButtonClick:function(a,c){var b;if(n&&n.isShowing()){b=zm("#frReq_row_"+c);zm(a).parent().html('<img src="'+zmConfig.IMAGE_URL+'/v3/images/loading_small.gif" />')}else{b=zm(a).parents(".zme_notify");zm(a.parentNode).empty().addClass("reqLoading")}this.reject(c,function(){j--;b.remove();x()})},showFriendRequests:function(){if(j==0){zm.Boxy.alert("Bạn không có lời mời kết bạn nào.","Thông báo",2000);return}if(!n){var a="Lời mời kết bạn";if(j){a+=" ("+j+")"}n=new zm.Boxy({title:a,content:'<div class="friend-item popupinvitefrd"><div class="rowtop">						<input id="frReq_ickall" type="checkbox" class="checkbox checkBR"><span class="linkchoose"><a id="frReq_ckall" href="#">Chọn tất cả</a>&nbsp;|&nbsp;<a id="frReq_clrall" href="#">Bỏ chọn</a></span>						<div class="btn fr"><a id="frReq_del" href="#" class="btn_L2"><em>Xoá</em></a></div><div class="clr"></div></div>						<div id="frReq_allwp" ></div><div class="clr"></div></div>',contentClass:"lbx_widlar",okButton:"Đóng"});m=new zm.ScrollableUI({height:400,width:584,alwaysShow:true,onscroll:zmFriendRequests.hideTotalMutual,scrollbarClass:"friendreq",content:'<div id="frReq_all"></div><div id="frReq_all_more" align="center" class="hBtnC"><img src="'+zmConfig.IMAGE_URL+'/v3/images/loading_small.gif" style="padding: 3px 0 4px 0; display: none;" /><a class="ico" href="#" onclick="return false;">Xem thêm</a></div>'});zm("#frReq_allwp").append(m.getElement());zm("#frReq_all_more").click(function(){if(this.nodeName.toLowerCase()=="a"||zm(this).children("a").css("display")!="none"){u()}});zm("#frReq_ickall").click(k);zm("#frReq_ckall").click(k);zm("#frReq_clrall").click(k);zm("#frReq_del").click(E);zm(window).scroll(zmFriendRequests.hideTotalMutual);s()}else{F?s():n.show()}},showTotalMutual:function(b,a){if(v){clearTimeout(v)}v=setTimeout(function(){zm.getJSON(zmConfig.FRIEND_URL+"/widget/num/mutual?uid="+a+"&cb=?",function(c){zm(b).calloutPopup(c)})},100)},hideTotalMutual:function(){if(v){clearTimeout(v)}zm(document.body).hideCalloutPopup()},sendMakeFriendRequest:function(g,e,a){var b=H+"userid_to="+g;if(a){for(var f in a){b=b+"&"+f.toString()+"="+a[f]}}var c=a.check_avatar;var d=zmConfig.FRIEND_URL+"/widget/check/privacy?userid_to="+g+"&cb=?";zm.getJSON(d,function(h){if(h.data==2&&h.error==0){if(c==1){zmFriendRequests.openFormSendRequest(g,e,a)}else{zmFriendRequests.send(g,e,a)}}else{zwg.addItem("prv_"+g,"ZMED_"+g+"?id=1&l=3");zm.Boxy.alert('<div><span id="prv_'+g+'" />&nbsp;không nhận lời mời kết bạn</div>',"Thông báo",4000,{okButton:"Đóng"});try{zwg.fillWg()}catch(I){}}})},acceptFriendRequest:function(a){zmFriendRequests.accept(a,function(){var c="frReqBoxyMsg-"+a;zm.Boxy.alert('<div id="'+c+'">Bạn và <span class="frReqName" id="frna_'+a+'"></span> đã là bạn của nhau. Hãy sang thăm trang cá nhân của <span class="frReqName" id="frnb_'+a+'" ></span></div>',"Thông báo",10000,"Đóng");try{zwg.addItem("frna_"+a,"ZMED_"+a+"?id=1&l=3");zwg.addItem("frnb_"+a,"ZMED_"+a+"?id=1&l=3");try{zwg.fillWg()}catch(d){}}catch(b){}});return false},limitLengthContent:function(b,c,a){if(b.value.length>c){b.value=b.value.substring(0,c);zm("#"+a).html(0)}else{zm("#"+a).html(c-b.value.length)}},openFormSendRequest:function(b,e,d){D=d;l=e;zm.data(window,"zmFriendRequests.form.uid",b);if(!C){C=new zm.Boxy({title:"Yêu cầu kết bạn",contentClass:"lbx_widmid",okButton:"Kết bạn",cancelButton:"Đóng",fixIframeTop:true,zIndex:1,onOk:function(){var f=zm("#makefriendrq_msg").val();var h=A(f);D.content=f;var g=zm.data(window,"zmFriendRequests.form.uid");if(h){zmFriendRequests.send(g,l,D)}return false}})}var c="";zwg.addItem("a_"+b,"ZMEA_"+b+"?id=1&l=2&size=50&width=50&height=50");zwg.addItem("n_"+b,"ZMED_"+b+"?id=1&l=2");c+='<div id="makefriendPopup">';c+='<div class="makefrdrowinfo">';c+='    <div class="avtmakefrd">';c+='        <strong><span class="frReqAva" id="a_'+b+'"></span></strong>';c+="    </div>";c+='    <div class="infomakefrd">Hai người sẽ trở thành <strong>bạn</strong> của nhau sau khi ';c+='        <strong><span class="frReqN" id="n_'+b+'"></span></strong> xác nhận lời mời này';c+="    </div>";c+="</div>";c+='<div class="makefrdrowinfo">';c+="    <p>	";c+='        <span class="fl f12"><strong>Viết lời nhắn</strong></span>';c+='        <span class="fr">Giới hạn <span class="txtredmakefrd"><strong id="countmakeFriend">300</strong></span> ký tự</span>';c+='        <br class="clr">';c+="    </p><p>";c+="    </p><p>Gửi lời chào và giới thiệu bản thân với bạn của bạn.</p>";c+='    <p class="grey">VD: Chào bạn, mình là sinh viên ĐH Bách Khoa khóa MT10 đây.</p>';c+='    <textarea cols="" rows="" onkeyup="zmFriendRequests.limitLengthContent(this, 300, \'countmakeFriend\');"  id="makefriendrq_msg" class="textarea_makefrd"></textarea>';c+="</div>";c+="</div>";C.setContent(c);C.show();zm("#makefriendrq_msg").focus();try{zwg.fillWg()}catch(a){}},rejectFriendSuggestion:function(c,a,d){if(d){for(var b in d){c=c+"&"+b.toString()+"="+d[b]}}zm.getJSON(c,function(e){typeof a==="function"&&a(e)})},updateAvatar:function(e,c){if(!G){G=new zm.Boxy({title:"Thông báo",contentClass:"lbx_widmid",okButton:"Cập nhật",cancelButton:"Đóng",fixIframeTop:true,zIndex:2,onOk:function(){zmAvatar.showAvatarBox()}})}var d="",b="frReqAvatar-"+c;d+="<div id='"+b+"' style='text-align: left; margin:0px 10px'>Vui lòng cập nhật avatar của bạn trước khi thực hiện kết bạn với ";d+="<strong><span id=fupd_avt_"+c+' class="frReqName"></span></strong></div>';zwg.addItem("fupd_avt_"+c,"ZMED_"+c+"?id=1&l=3");G.setContent(d);G.show();try{zwg.fillWg()}catch(a){}}}})();var zme_wg_cb="rsize";function show_request_recent(b){zmFriend.showRecently(b)}function show_request_status(b){zmFriend.showStatus(b)}var zmFriend=(function(){var p=0;var A=0;var z=0;function t(){zm("#async_status").show();zm("#wmorefriend a").hide()}function x(){zm("#async_status").hide();zm("#wmorefriend a").show()}function v(){zm("#async_status_interest").show();zm("#async_status_interest").hide()}function w(){zm("#async_status_interest").hide();zm("#wmorefriend_interest").show()}function o(){var a=zm("#list_friend").children().size();if(a==0){window.location.reload()}}function u(d){var b="";var a=new Array();var c=0;zm.each(d,function(){if(this.uid){b+='<div class="row line" id="part_'+this.uid+'">                        <input type="checkbox" name="chkfriend[]" value='+this.uid+' class="checkbox" />                        <div class="maincont">                            <span id="avt_'+this.uid+'" width="75" height="75" class="avatar"></span>                                <span class="cont">                                    <div class="name">                                        <span id="fn_'+this.uid+'"></span>                                    </div>                                    <div class="icofeed ficon1"></div>                                    <span class="disp_status" name="disp_status" id="status_'+this.uid+'" rel="'+this.uid+'" ></span>                                    </span>                            <div class="clr"></div>                            </div>                        <div class="btn fr">'+((!this.isint)?'<span id="add_interest_'+this.uid+'" >  <a  class="btn_L3" title="Bạn thân" onclick="zmFriend.addInterestedFriendList('+this.uid+'); return false; " href="#" > <em>Bạn thân</em></a> </span>':'<img  border="0" src="'+zmConfig.IMAGE_URL+'/images/tick_16.png" alt="Đã là bạn thân" title="Đã là bạn thân"/>')+' <a onclick="zmFriend.deleteFriend('+this.uid+');return false; " href="#" class="btn_L5"><em>Xoá</em></a>                        </div>                        <div class="clr"></div>                        </div>';zwg.addItem("avt_"+this.uid,"ZMEA_"+this.uid+"?id=1&l=3&width=120&height=120&size=120");zwg.addItem("fn_"+this.uid,"ZMED_"+this.uid+"?id=1&l=3");a[c]=this.uid;c++}});if(b.length>0){zm("#list_friend").append(b);resizeFrame();zwg.fillWg();zmFriend.getStatus(a)}else{zm("#wmorefriend").hide()}}function s(d){var b="";var a=new Array();var c=0;zm.each(d,function(){if(this.uid){b+='<div class="row line" id="part_'+this.uid+'">                        <input type="checkbox" name="chkfriend[]" value='+this.uid+' class="checkbox" />                        <div class="maincont">                            <span id="avt_'+this.uid+'" width="75" height="75" class="avatar"></span>                                <span class="cont">                                    <div class="name">                                        <span id="fn_'+this.uid+'"></span>                                    </div>                                    <div class="icofeed ficon1"></div>                                    <span class="disp_status" name="disp_status" id="status_'+this.uid+'" rel="'+this.uid+'" ></span>                                    </span>                            <div class="clr"></div>                            </div>                        <div class="btn fr"> <a onclick="zmFriend.delInterestedFriendList('+this.uid+');return false; " href="#" class="btn_L5"><em>Xoá</em></a>                        </div>                        <div class="clr"></div>                        </div>';zwg.addItem("avt_"+this.uid,"ZMEA_"+this.uid+"?id=1&l=3&width=120&height=120&size=120");zwg.addItem("fn_"+this.uid,"ZMED_"+this.uid+"?id=1&l=3");a[c]=this.uid;c++}});if(b.length>0){zm("#list_friend").append(b);resizeFrame();zwg.fillWg();zmFriend.getStatus(a)}else{zm("#wmorefriend_interest").hide()}}function y(d){var b="";var a=new Array();var c=0;zm.each(d,function(){if(this.fid){b+='<div class="row line" id="part_'+this.fid+'">                            <div class="maincont">                                <span id="avt_'+this.fid+'" width="75" height="75" class="avatar"></span>                                <span class="cont">                                    <div class="name">                                        <span id="fn_'+this.fid+'"></span>                                    </div>                                    <div class="icofeed ficon1"></div>                                    <span class="disp_status" name="disp_status" id="status_'+this.fid+'" rel="'+this.fid+'" ></span>                                </span>                                <div class="clr"></div>                            </div>                            <div class="btn fr" id="btnMf_'+this.fid+'">';if((this.isvip==1)&&!this.isfan){b+='<a id="btnhm_'+this.fid+'" onclick="zmHotProfile.requestHot('+this.fid+',fanHotProfileOwn);return false;" class="btn_L3" href="#"><em>Hâm mộ</em></a>'}else{if((this.isvip==2)&&!this.isfan){b+='<a  id="btnth_'+this.fid+'" onclick="zmHotProfile.requestBiz('+this.fid+',fanBizProfileOwn);return false;" class="btn_L3" href="#"><em>Thích</em></a>'}else{if(this.isfr){b+="<span><em></em></span>"}else{if(this.isfrq){b+="<span><em>Đang chờ phản hồi kết bạn</em></span>"}else{if(!this.isvip){b+='<a onclick="zmFriendRequests.sendMakeFriendRequest('+this.fid+",makeFriendCB,{'check_avatar':1,'source':"+this.source+"h:"+this.hash+'}); return false;" class="btn_L3" href="#"><em>Kết bạn</em></a>'}}}}}b+="   </div>";b+='   <div class="clr"></div>';b+="</div>";zwg.addItem("avt_"+this.fid,"ZMEA_"+this.fid+"?id=1&l=3&width=120&height=120&size=120");zwg.addItem("fn_"+this.fid,"ZMED_"+this.fid+"?id=1&l=3");a[c]=this.fid;c++}});if(b.length>0){zm("#list_friend").append(b);resizeFrame();zwg.fillWg();zmFriend.getStatus(a)}else{zm("#wmorefriend").hide()}}function q(d){var b="";var a=new Array();var c=0;zm.each(d,function(){if(this.fid){b+='<div class="row line" id="part_'+this.fid+'">                            <div class="maincont">                                <span id="avt_'+this.fid+'" width="75" height="75" class="avatar"></span>                                <span class="cont">                                    <div class="name">                                        <span id="fn_'+this.fid+'"></span>                                    </div>                                    <div class="icofeed ficon1"></div>                                    <span name="disp_status" id="status_'+this.fid+'" rel="'+this.fid+'" ></span>                                </span>                                <div class="clr"></div>                            </div>                            <div class="btn fr" id="btnMf_'+this.fid+'">';b+="   </div>";b+='   <div class="clr"></div>';b+="</div>";zwg.addItem("avt_"+this.fid,"ZMEA_"+this.fid+"?id=1&l=3&width=120&height=120&size=120");zwg.addItem("fn_"+this.fid,"ZMED_"+this.fid+"?id=1&l=3");a[c]=this.fid;c++}});if(b.length>0){zm("#list_friend").append(b);resizeFrame();zwg.fillWg();zmFriend.getStatus(a)}else{zm("#wmorefriend").hide()}}function r(b){var a=zmConfig.FRIEND_URL+"/act/deletefriend/friends/"+b;zm("#friend_proccess_"+b).show();zm.get(a,{dataType:"json"},function(c){if(c.error!=0){zm("#friend_proccess_"+b).hide();new zmCore.Boxy({title:"Thông báo ",contentClass:"lbx_widmid",content:c.msg,modal:true,okButton:"Đồng ý"}).show()}else{zm("#part_"+b).remove();o()}})}return{deleteSuggest:function(a){var b=zmConfig.FRIEND_URL+"/act/rejectsuggest?uidto="+a;zm.get(b,{dataType:"json"},function(c){zm("#rqf_"+a).remove();var d=zm("#friend_suggest_content").children().size();if(d==0){window.location.reload()}})},getStatus:function(b,a){if(!b){b=new Array();var c=0;zm("span.disp_status").each(function(){b[c]=zm(this).attr("rel");c++});if(c==0){return}}var e=b.join(",");var d=zmConfig.FRIEND_URL+"/widget/requeststatus?list="+e;zm.addScript(d,a)},showStatus:function(a){if(a){zm("#"+a.idx).html(a.sts)}},getRecently:function(a){var d=new Array();var b=0;zm("ul[name=rrecent]").each(function(){d[b]=zm(this).attr("rel");b++});if(b==0){return}var e=d.join(",");var c=zmConfig.FRIEND_URL+"/widget/requestrecent?list="+e;zm.addScript(c,a)},showRecently:function(a){if(a.data){var c=a.data;var b="";for(i=0;i<c.length;i++){b=b+"<li>";b=b+'<span class="icofeed ficon_'+c[i][0]+'"></span>';b=b+'<a href="'+c[i][2]+'" target="_blank" >'+c[i][1]+"</a>";b=b+'<span class="grey">'+c[i][3]+"</span>";b=b+"</li>"}zm("#"+a.idx).html(b)}},getMoreFriend:function(){t();p++;zm.get(zmConfig.FRIEND_URL+"/widget/get-friend?p="+p,{dataType:"json"},function(a){u(a.list);x();if(a.more!=true){zm("#wmorefriend").remove()}})},getMoreFriendInterest:function(){v();A++;zm.get(zmConfig.FRIEND_URL+"/widget/get-friend-interest?p="+A,{dataType:"json"},function(a){s(a.list);w();if(a.more!=true){zm("#wmorefriend_interest").remove()}})},getMoreFriendOwner:function(a){t();p++;zm.get(zmConfig.FRIEND_URL+"/widget/zmfriend?vid="+a+"&p="+p,{dataType:"json"},function(b){y(b.friends);x();if(b.more!=true){zm("#wmorefriend").remove()}})},getMoreFriendMutual:function(a){t();z++;zm.get(zmConfig.FRIEND_URL+"/widget/zmfriend-mutual?vid="+a+"&p="+z,{dataType:"json"},function(b){q(b.friends);x();if(b.more!=true){zm("#wmorefriend").remove()}})},addInterestedFriendList:function(b){zm("#link_interest_"+b).hide();zm("#friend_proccess_"+b).show();var a=zmConfig.FRIEND_URL+"/act/addinterest/friend/"+b;zm.get(a,{dataType:"json"},function(c){zm("#add_interest_"+b).html('<img  border="0" src="'+zmConfig.IMAGE_URL+'/images/tick_16.png"/>');zm("#friend_proccess_"+b).hide()})},delInterestedFriendList:function(b){zm("#friend_proccess_"+b).show();var a=zmConfig.FRIEND_URL+"/act/removeinterest/friend/"+b;zm.get(a,{dataType:"json"},function(c){zm("#part_"+b).remove()})},deleteFriend:function(a){zmCore.Boxy.confirm("Bạn có muốn xóa người này khỏi danh sách bạn bè không?",function(){r(a)},{title:"Xóa bạn bè ",modal:true,okButton:"Đồng ý",cancelButton:"Đóng"})},checkAll:function(a,b,c){if(c!==undefined){zm("#"+a+"").attr("checked",c)}zm("INPUT[type='checkbox'][name='"+b+"[]']").attr("checked",zm("#"+a).attr("checked"))},checkAllFriend:function(a){return zmFriend.checkAll("checkAllFriend","chkfriend",a)},deleteListFriend:function(){var c=zm("INPUT[type='checkbox'][name='chkfriend[]']");if(c.length<=0){return}var b=0;var a=new Array();c.each(function(){if(zm(this).attr("checked")==true){a[b]=zm(this).val();b++}});if(b==0){zm.Boxy.alert("Vui lòng chọn bạn để xóa","Thông báo",2000,{okButton:"Đóng"})}else{new zmCore.Boxy({title:"Thông báo",contentClass:"lbx_widmid",content:"Bạn có muốn xóa những người này khỏi danh sách bạn bè không?",modal:true,fixIframeTop:true,okButton:"Xóa",cancelButton:"Bỏ qua",onOk:function(){var d=a.join(",");var e=zmConfig.FRIEND_URL+"/act/deletefriend";zm.post(e,{friends:d},{dataType:"json"},function(f,g){window.location.reload()})},onCancel:function(){}}).show()}},switchListFriend:function(a){window.location.href=zmConfig.FRIEND_URL+"/friendv4/friend/list?t="+a},switchListProfile:function(a){window.location.href=zmConfig.FRIEND_URL+"/friendv4/friend/list?pt=1&t="+a},changeOwnerFriedList:function(b,a){if(b==1){window.location.href=zmConfig.FRIEND_URL+"/friendv4/friend/mutual?u="+a}else{window.location.href=zmConfig.FRIEND_URL+"/friendv4/friend/listownf?u="+a}}}})();var zmSearchFriend=(function(){var u="http://search.me.zing.vn/friend/select?fl=userid&wt=json";var o=0;var m="";var p=0;var l=20;function s(){var a="&q=friendids:"+p;a=a+"%20AND%20pft_fullname:"+m;a=a+"&start="+o*l;a=a+"&rows="+l;var b=u+a+"&json.wrf=zmSearchFriend.parseResult";var c=document.createElement("SCRIPT");c.type="text/javascript";c.src=b;document.getElementsByTagName("HEAD")[0].appendChild(c)}function n(b){var d="";var c=new Array();var a=0;zm.each(b,function(){if(this.userid){d+='<div class="row line" id="part_'+this.userid+'">                        <input type="checkbox" name="chkfriend[]" value='+this.userid+' class="checkbox" />                        <div class="maincont">                            <span id="avt_'+this.userid+'" width="75" height="75" class="avatar"></span>                                <span class="cont">                                    <div class="name">                                        <span id="fn_'+this.userid+'"></span>                                    </div>                                    <div class="icofeed ficon1"></div>                                    <span name="disp_status" id="status_'+this.userid+'" rel="'+this.userid+'" ></span>                                    <ul class="app-f" rel="'+this.userid+'" id="rrecent_'+this.userid+'" name="rrecent"></ul>                                    </span>                            <div class="clr"></div>                            </div>                        <div class="btn fr">'+((!this.isint)?'<span id="add_interest_'+this.userid+'" >  <a  class="btn_L3" title="Bạn thân" id="link_interest_ '+this.userid+'" onclick="zmFriend.addInterestedFriendList('+this.userid+'); return false; " href="#" > <em>Bạn thân</em></a> </span>':'<img  border="0" src="'+zmConfig.IMAGE_URL+'/images/tick_16.png" alt="Đã là bạn thân" title="Đã là bạn thân"/>')+' <a onclick="zmFriend.deleteFriend('+this.userid+');return false; " href="#" class="btn_L5"><em>Xoá</em></a>                        </div>                        <div class="clr"></div>                        </div>';zwg.addItem("avt_"+this.userid,"ZMEA_"+this.userid+"?id=1&l=3&width=120&height=120&size=120");zwg.addItem("fn_"+this.userid,"ZMED_"+this.userid+"?id=1&l=3");c[a]=this.userid;a++}});if(d.length>0){zm("#searchfriend_content").append(d);zm("#searchfriend_content").show();resizeFrame();zwg.fillWg();zmFriend.getStatus(c)}}function r(b){var c="friendOwnerItems2-"+Math.floor((Math.random()*1000)),a='<div id="'+c+'">';zm.each(b,function(){a+='<div id="divpart_'+this.userid+'" class="rwFriend line" style="height:120px" >';a+='	<div class="avaCasi">';a+='		<div style="width:120px;height:120px"><span rel="XMEA_'+this.userid+'?id=1&l=2"></span></div>';a+="	</div>";a+='	<div class="iFriend">';a+='		<div style="max-width: 300px ! important;" class="userInfo">';a+="			<h1>";a+='				<span rel="XMED_'+this.userid+'?id=1&l=2"></span>';a+="			</h1>";a+='			<div rel="'+this.userid+'" id="rrecent_'+this.userid+'" name="rrecent"></div>';a+="		</div>";a+='		<br class="clr">';a+="	</div>";a+='	<br class="clr">';a+="</div>"});if(b.length>0){zm("#searchfriend_content").append(a);zm("#searchfriend_content").show();zmFriend.getRecently(function(){})}}function q(a){if(a){zm("#list_friend").show();zm("#wmorefriend").show();if(zm("#interest_friend")){zm("#interest_friend").show()}}else{zm("#list_friend").hide();zm("#wmorefriend").hide();if(zm("#interest_friend")){zm("#interest_friend").hide()}}}function t(a){if(a){zm("#rowtop").show();zm("#ftotal").show()}else{zm("#rowtop").hide();zm("#ftotal").hide()}}return{search:function(b,a){if(!a){return false}b=zm.trim(b);if(b==""){q(true);t(true);zm("#searchfriend_content").hide();return false}if(m==b){return}zm("#searchfriend_content").html("");q(false);t(true);m=b;p=a;o=0;s()},moresearch:function(){o++;s()},parseResult:function(a){if(a.response.numFound<=0){zm("#searchfriend_content").html("<center>Không tìm thấy <strong>"+m+"</strong></center> ");zm("#searchfriend_content").show();t(false)}else{if(is_owner){n(a.response.docs)}else{renderFriendOwnerItems(a.response.docs)}if(a.response.numFound>(o*l+l)){if(zm("#wmorefriend").size()==0){var b='<a class="btn_peal" onclick="zmSearchFriend.moresearch(); return false;" href="#"><em>Xem thêm</em></a>';zm("#wmorefriend").append(b)}}else{if(zm("#wmorefriend").size()!=0){zm("#wmorefriend").hide()}}resizeFrame()}}}})();var zmFollower=(function(){var g=0;function e(){zm("#async_status").show();zm("#wmorefriend").hide()}function h(){zm("#async_status").hide();zm("#wmorefriend").show()}function f(c){var a="friendFollower-"+Math.floor((Math.random()*1000)),b='<div id="'+a+'">';zm.each(c,function(){b+='<div id="divpart_follow'+this+'" class="rwFriend line">';b+='	<div class="avaCasi">';b+='		<span rel="XMEA_'+this+'?id=1&l=2"></span>';b+="	</div>";b+='	<div class="iFriend">';b+='		<div style="max-width: 300px ! important;" class="userInfo">';b+="			<h1>";b+='				<span rel="XMED_'+this+'?id=1&l=2"></span>';b+="			</h1>";b+="		</div>";b+='		<br class="clr">';b+="	</div>";b+='		<span id="friend_proccess_'+this+'" style="display: none;"><img class="img" src="'+zmConfig.IMAGE_URL+'/images/7hwy7at6.gif" alt=""></span>';b+='	<div style="width: 100px ! important;" class="mroption">';b+='		<div class="icon_Closecoment">';b+='			<a onclick="zmFollower.delMyVip('+this+',delvipcallback);return false;" href="#"><img width="20" height="18" border="0" onmouseout="this.src=\'http://img.me.zdn.vn/images/zme_closeAll.png\'" onmouseover="this.src=\'http://img.me.zdn.vn/images/zme_closeAlls.png\'" src="http://img.me.zdn.vn/images/zme_closeAll.png" title=" Xoa người hâm mộ  " alt="Xoa người hâm mộ "></a>';b+="		</div>";b+='		<br class="clr">';b+="	</div>";b+='	<br class="clr">';b+="</div>"});if(c.length>0){zm("#listfollow").append(b);ZMEW_widget_mix(a)}else{zm("#wmorefriend").hide()}}return{addfan:function(a,b){var c=zmConfig.FRIEND_URL+"/act/addfan/vipid/"+a;zm.get(c,{dataType:"json"},function(d){if(typeof(b)=="function"){b(a)}})},delMyVip:function(a,b){var c=zmConfig.FRIEND_URL+"/act/delvip/vipid/"+a;zm.get(c,{dataType:"json"},function(d){if(typeof(b)=="function"){b(a)}})},getMoreVip:function(){e();g++;zm.get(zmConfig.FRIEND_URL+"/friendv3/follow/get-more-vip?p="+g,{dataType:"json"},function(a){f(a.list);h();if(a.more!=true){zm("#wmorefriend").remove()}})}}})();