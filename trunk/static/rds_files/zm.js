var zmPW=(function(){var z=500,t=500,v=200,h=6,q=["","vipstar","vipbiz","vipcommunity"];var u=zmConfig.FULLPROFILE_URL+"/getinfo?u=",s=zmConfig.MINIPROFILE_URL+"/api/minip?method=getMini&viewer="+zmConfig.viewerName+"&uname=",i=zmConfig.BASE_URL+"lcinfo/info";var r={},c,A,C,j={};zm.ready(function(){document.body.appendChild(zm.createElement("DIV",{"class":B(),id:"mppopup"},{top:"-9999px",left:"0px"}));document.body.appendChild(zm.createElement("DIV",{"class":B(),id:"mppopuptemp"},{top:"-9999px",left:"0px"}));zm("#mppopup").hover(function(){if(zmPW.leaveTimeout){clearTimeout(zmPW.leaveTimeout)}},function(){if(zmPW.hoveredElement){zmPW.leaveTimeout=setTimeout(function(){m();zmPW.hoveredElement=null},v)}}).mouseup(function(E){E.stopPropagation()}).html('<span id="mparrowtop" class="icodisbox" style="display: none"></span><div id="mpctn" class="disbox"></div><span id="mparrowbot" class="icodisbox" style="display: none"></span>');zm("#mppopuptemp").html('<span class="icodisbox topright"></span><div id="mpctntemp" class="disbox"></div><span id="mparrowbottemp" class="icodisbox botleft"></span>');zm(window).scroll(function(){zmPW.hm()})});function B(E){if(E=="chat"){return"ctndisbox disbox_chat"}return"ctndisbox disbox_minipro"}function D(E){if(!E||!zm.isString(E)){return null}var F=E.split("-");if(!F||F.length<3){return null}return{day:F[2],month:F[1],year:F[0]}}function p(F){var E="";if(F){if(F.lastUpdate>0){E+=zmDateTime.format(F.lastUpdate/1000)+'<span class="icodot"></span>'}E+=F.totalComment+' bình luận<span class="icodot"></span><span class="likelink">'+F.totalLike+" thích</span"}return E}function f(Z,T,Y,E){var M=Z.uid,G=Z.uname,H=Z.type,L=M==zmConfig.viewerId,I=Z.isf&&!L,V="zmp_"+M,N=T=="chat"?100:120,P='<div class="contdisbox"><div class="disbox_inner"><a href="#" onclick="zmPW.hideMiniProfile(); return false;" class="disboxclose" title="Đóng" style="top: -4px; right: -4px;">Đóng</a><div class="usercolt">';if(Z.isCert&&Z.certAvaPath){P+='<a href="/u/'+G+'" target="_blank"><img width="'+N+'" height="'+N+'" src="'+Z.certAvaPath+'" /></a>'}else{P+='<span id="'+V+'" style="width: '+N+"px;height: "+N+'px;display: inline-block;"></span>';zwg.addItem(V,"ZMEA_"+M+"?id=1&l=2&size=120&width="+N+"&height="+N)}var X="";if(H!=0){var W=q[H];if(Z.tf<500){W+="grey"}X='<span class="icovip '+W+'"></span>'}P+='</div><div class="usercolrt"><div'+(T=="chat"?"":' class="usertxtinfo'+(I?"":" nofrd")+'"')+'><p class="box_username">'+X+'<a class="f12" href="'+zmConfig.ME_URL+"/u/"+G+'" target="_blank"><strong>'+zm.trim(Z.displayName)+"</strong></a>";if(H==0){if(Z.isCert){P+='<a href="/apps/chungthuc" target="_blank"><span class="icocer ico_certified marl5"></span></a>'}else{P+='<span class="icocer ico_notcertified marl5" style="cursor: default;"></span>'}}P+="</p>";if(Z.job){P+='<p class="rowminipro"><span class="grey">Làm tại:</span> '+Z.job+"</p>"}else{if(Z.school){P+='<p class="rowminipro"><span class="grey">Học tại:</span> '+Z.school+"</p>"}}if(T=="chat"){var S=zm(Y).find(".zmchat-stttext").html(),aa="",J="";if(E>0){aa='<span class="icodot"></span><a href="'+zmConfig.PROFILE_URL+"/"+G+"?feedid="+E+'" target="_blank">Xem chi tiết</a>'}if(j[E]){J=p(j[E])}if(S){P+='<div class="contstt_chat"><img class="note-l" src="http://'+zm.config.hostImage+'/images/blank.gif" /><span class="f12"><strong>'+S+'</strong></span></div>					<p id="mpstt_'+E+'" class="grey">'+J+aa+"</p></div>"}else{P+="</div>"}delete j[E]}else{var O,K;if(H==0){O=Z.fids;K=Z.tfr}else{O=Z.fanids;K=zmString.formatNumber(Z.tf)}if(!I){P+="</div>"}if(O&&O.length>0){var F="&nbsp;";if(K){if(H==0){F='<p class="grey"><a href="'+zmConfig.BASE_URL+"fr/"+G+'/ownerf" target="_blank">Có <strong>'+K+"</strong> bạn</a></p>"}else{F='<p>Có <span class="f12"><strong>'+K+"</strong></span> người "+(H==1?"hâm mộ":"thích")+"</p>"}}P+=F+'<ul class="genfrd">';for(var U=0;(U<h&&U<O.length);U++){var R="zmp_"+O[U];P+="<li"+((U==h-1||U==O.length-1)?' class="end"':"")+'><span id="'+R+'"></span></li>';zwg.addItem(R,"ZMEA_"+O[U]+"?id=1&l=2&size=50&width=34&height=34")}P+="</ul>"}if(I){P+="</div>"}}if(!L&&top==window){if(H==0&&T!="chat"){if(Z.isf){P+='<div id="mpbtns" class="btnboxinfo_user"><a class="btn_colright givegift marightbn" id="mpsendgift" href="/apps/gift?params=/api/index/index/user/'+G+'">Tặng quà</a><a href="#" id="mppoke" class="btn_colright tease marightbn">Chọc ghẹo</a><a id="mpsendmsg" class="btn_colright message" href="#">Nhắn tin</a></div>'}}P+='</div></div><div class="clr"></div></div>';if(T=="chat"){P+='<div class="footerboxinfo_user"><a id="mpsendmsg" style="float:right !important; margin-right:0;" href="#" class="btn_L7"><span class="icn12x12 icn_msg12x12"></span><em>Nhắn tin</em></a><a style="float:right !important; margin-right:8px;" class="btn_L7" href="#" onclick="zmChat.chatWith('+M+');return false;"><span class="icn12x12 icn_chat12x12"></span><em><strong>&nbsp;Chat&nbsp;&nbsp;</strong></em></a>'}else{var Q="Viết gì đó cho "+Z.displayName;if(Z.isf){P+='<div class="footerboxinfo_user" style="height:27px !important"><div class="stt_minipro fl"><textarea id="mpptwtxt" rel="'+Q+'">'+Q+'</textarea></div><a id="mpptwbtn" class="btn_L1 fl" href="#"><em>Đăng</em></a></div>'}else{if(!Z.isfan){if(H==0){P+='<div class="footerboxinfo_user btn_action"><a id="mpmkfrd" style="float:right" href="#"><span class="icn12x12 icn_makefrd12x12"></span>Kết bạn</a></div>'}else{if(H==1){P+='<div class="footerboxinfo_user btn_action"><a id="mpfan" style="float:right" href="#"><span class="icn12x12 icn_fan12x12"></span>Hâm mộ</a></div>'}else{P+='<div class="footerboxinfo_user btn_action"><a id="mplike" style="float:right" href="#"><span class="icn12x12 icn_like12x12"></span>Thích</a></div>'}}}}}}else{P+='</div></div><div class="clr"></div></div>'}return P}function y(W,T,Y,Q,I){var N=zm(W),P=false;if(N.css("display")=="none"){P=true}else{N.parents().each(function(){if(zm(this).css("display")=="none"){P=true;return false}})}if(P){m();return}var M=Y||zm("#mppopup"),K=N.offset(true),V=zm.getViewport(),U=N.outerHeight(),S=M.outerHeight(),G=K.top+U/2,O=!!T,R,J,L,F;K.left+=zm.intval(N.css("padding-left"))+zm.intval(N.css("margin-left"));if(O){if(K.top-V.offsetY+20>V.height-S){R=K.top-S+U;L="bot"}else{R=K.top;L="top"}}else{if(V.offsetY+V.height/2<=G){R=K.top-S-7;L="bot"}else{R=K.top+U+7;L="top"}}var H=zm("#mparrow"+L);H.show();zm("#mparrow"+(L=="top"?"bot":"top")).hide();var E=M.outerWidth(),X=K.left+E+30;if(O){J=K.left-E-9}else{if(V.offsetX+V.width>X){J=K.left-zm.intval(zm("#mpctn").css("margin-left"));F="left"}else{J=K.left+N.width()-E+zm.intval(zm("#mpctn").css("margin-left"));F="right"}}typeof Q=="function"&&Q();if(T=="chat"){if(L=="bot"){L+="tom"}H.attr("class","icodisbox left"+L)}else{H.attr("class","icodisbox "+L+F)}zm("#mppopup").css({top:R+"px",left:J+"px"});typeof I=="function"&&I()}var a=function(){if(A&&typeof zmCommon!="undefined"){zmCommon.sendGift(A,null,"mini");zmPW.hideMiniProfile()}return false},k=function(){if(c&&typeof zmLightBox!="undefined"){zmLightBox.pokefriend("http://me.zing.vn/act/"+c+"/lightbox/poke","Chọc ghẹo");zmPW.hideMiniProfile()}return false},x=function(){if(c&&typeof zmAppMsg!="undefined"){zmAppMsg.showCompose(c);zmPW.hideMiniProfile()}return false},w=function(){if(A&&typeof zmFriendRequests!="undefined"){zmFriendRequests.sendMakeFriendRequest(A,null,{check_avatar:1,source:117});zmPW.hideMiniProfile()}return false},d=function(){c&&A&&typeof zmCommon!="undefined"&&zmCommon.subcribe("/act/"+c+"/lightbox/subcribe?key="+C,1,A,o);return false},n=function(){c&&A&&typeof zmCommon!="undefined"&&zmCommon.subcribe("/act/"+c+"/lightbox/subcribe?key="+C,2,A,o);return false},l=function(){var E=zm("#mpptwtxt"),F=zm.trim(E.val());if(F==E.attr("rel")){E.focus()}else{if(c&&typeof zmStatus!="undefined"&&F){zmStatus.setStatus("",F,{to:c,checkText:false});m()}}return false},o=function(E){if(E.status=="success"){if(c&&r[c]){r[c].isfan=true}zm("#mplike").parent().html('<div style="float: right;">'+E.content+"</div>")}else{if(E.type=="alert"){zm.Boxy.alert(E.content,"Thông báo",3000)}}};function b(F,G,H,E){zm("#mpctntemp").html(f(G,H,F,E));zm("#mppopup").attr("class",B(H));zm("#mppopuptemp").attr("class",B(H));if(E>0){zm.post(i,{viewerId:zmConfig.viewerId,feedId:E},{dataType:"json"},function(J){if(J.errorCode!=0){return}var I=zm("#mpstt_"+E);if(I.size()>0){I.prepend(p(J.data))}else{j[E]=J}})}y(F,H,zm("#mppopuptemp"),function(){zm("#mpctn").empty().removeClass("nodata").append(zm("#mpctntemp").children());zwg.fillWg();c=G.uname;A=G.uid;C=G.k},function(){zm("#mpsendgift").click(a);zm("#mppoke").click(k);zm("#mpsendmsg").click(x);zm("#mpmkfrd").click(w);zm("#mpfan").click(d);zm("#mplike").click(n);zm("#mpptwtxt").keypress(function(I){if(!I.shiftKey&&I.keyCode==13){return l()}}).keydown(function(I){if(I.keyCode==27){this.value=""}}).focus(function(){var I=zm(this);if(I.val()==I.attr("rel")){I.val("")}}).blur(function(){var I=zm(this);if(I.val()==""){I.val(I.attr("rel"))}});zm("#mpptwbtn").click(l)})}function m(){zm("#mppopup").css({top:"-9999px",left:"0px"});c=null;A=null}function g(F,E,G){switch(E){case 1:zm("#mpctn").html('<p align="center">Tài khoản này không tồn tại.</p>').addClass("nodata");break;default:zm("#mpctn").html('<p align="center">Có lỗi xảy ra! Xin vui lòng thử lại.</p>').addClass("nodata");break}y(F,G)}function e(E,F){zm("#mpctn").html('<p class="disbox_loading"></p>').addClass("nodata");y(E,F)}return{mixHover:function(F,H,E){var G;if(zm.isString(F)&&!E){F="#"+F}if(F instanceof zmCore){G=F}else{G=zm(F)}G.each(function(){if(!zm.data(this,"miniprofile")){var J=zm(this),I=J.attr("href");zm.isString(I)&&I.indexOf("/u/")>=0&&J.hover(function(){zmPW.sm(this)},function(){zmPW.hm()});zm.data(this,"miniprofile",true)}})},showMiniProfile:function(I,F,H,E){I=zm.trim(I);if(!I||!F){return}zmPW.hoveredElement=F;var G=r[I];if(G){b(F,G,H,E)}else{setTimeout(function(){if(!zmPW.hoverTimeout){return}e(F,H);var J="&fields="+(H=="chat"?"":"gender,")+"school,job";zm.getJSON(s+I+J,function(M){var L=M==undefined?3:M.err,K=F==zmPW.hoveredElement;if(L!=0){K&&g(F,L,H)}else{r[I]=M.data;K&&b(F,M.data,H,E)}})},t)}},hideMiniProfile:function(){if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout);delete zmPW.hoverTimeout}if(zmPW.leaveTimeout){clearTimeout(zmPW.leaveTimeout)}m()},sm:function(F,H,G,E){if(zmPW.leaveTimeout){clearTimeout(zmPW.leaveTimeout)}if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout)}zmPW.hoverTimeout=setTimeout(function(){var I=/\/u\/([a-z0-9\.\-_]+)\/?.*/i.exec(zm(F).attr("href"));zmPW.showMiniProfile((I&&I[1])||H,F,G,E)},z)},hm:function(){if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout);delete zmPW.hoverTimeout}zmPW.leaveTimeout=setTimeout(function(){m()},v)}}})();