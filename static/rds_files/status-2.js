var zmStatus=(function(){var ae=-1,w=0,h=1,Q=2,R=3,ag=4,r=w,S=zmConfig.IMAGE_URL+"/v3/images/event/bglbx_womenday.jpg",f,q,e,W=false,C=0,c,n,j=0,U,D=false,b=-1,a,Z,X,L,s,p,ab=-1,I,O=[],T=false,E,u,Y;function k(aj){if(aj==1){zm("#idOpenImg").show();zm("#idCloseImg").show();zm("#spStatus").show();zm("#spStatusDate").show();zm("#curStatus").show()}else{zm("#idOpenImg").hide();zm("#idCloseImg").hide();zm("#spStatus").hide();zm("#spStatusDate").hide();zm("#curStatus").hide();zm("#delStatusId").hide()}}var i={beforeHide:function(){var aj=zm("#txtStatus");aj.val()!=zmStatus.getDefVal()&&aj.attr("disabled","").css({color:"#333"}).focus()}},H=function(ak,aj,al){if(aj&&aj.contentRender){if(f==Q){q=null}if(W){e=null}W=false;zm.isFunction(al)&&al(aj)}else{if(j<zmStatus.FEED_RETRY){j++;if(j<=1){K(ak,al,H)}else{setTimeout(function(){K(ak,al,H)},2000)}}else{if(f==Q&&c==0){zm.Boxy.alert("Đăng ảnh thành công","Thông báo",2000);zm.isFunction(al)&&al(aj);return}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau","Thông báo",2000)}if(f==Q){zmStatus.showPhoto()}else{if(f==ag&&!W){zmStatus.showLink()}else{zmStatus.showStatus()}}W=false}}};function K(aj,al,ak){zm.get(zmStatus.GET_FEED_URL+aj,{dataType:"json"},function(am){zm.isFunction(ak)&&ak(aj,am,al)},function(){zm.isFunction(ak)&&ak(aj,null,al)})}var v=function(){if(r!=Q){zmStatus.reset();r=Q;n=null;var aj=zm("#txtStatus");if(q){aj.val(q)}else{zm("#photo-form").reset();aj.val(zmStatus.getDefVal())}zm("#photobox").hide();zm("#status-cont").show();zm("#photo-title").show();zm("#photo-cont").show();zm("#status-close").show();aj.attr("class",s+" share-desc photo-desc "+L).css({height:"18px",color:""});aj.data("autoresize.stop",true);Z&&zm("#status-arrow").show().css("left",Z+"px")}return false},B=function(aj){if(aj.data.album_privacy==1){zm.Boxy.alert('Ảnh của bạn đã được thêm vào album <strong><a href="'+aj.data.album_url+'" target="_blank">Ảnh trên tường</a></strong>',"Thông báo");zmStatus.showStatus()}else{if(aj.error_code!=0){zm.Boxy.alert(aj.error_message,"Thông báo",2000);v()}else{C=0;c=aj.error_code;n=aj.point;m(aj.data.photo_id,aj.token)}}},m=function(aj,ak,al){if(al&&al.data&&al.data.feed_id){zmStatus.getFeedContent(al.data.feed_id,function(){zmStatus.showStatus();n>0&&setTimeout(function(){zmCommon.plusPoint("+"+n,"status-cont",{offsetLeft:-20,offsetTop:-20})},1000)})}else{if(C<zmStatus.PHOTO_RETRY){C++;if(C<=1){g(aj,ak,m)}else{setTimeout(function(){g(aj,ak,m)},1000)}}else{if(c!=0&&c!=null){zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau","Thông báo",2000)}else{zm.Boxy.alert("Đăng ảnh thành công","Thông báo",2000)}zmStatus.showPhoto()}}};function g(ak,al,aj){zm.getJSON(zmStatus.GET_FPHOTOID_URL+"photo_id="+ak+"&token="+al,function(am){zm.isFunction(aj)&&aj(ak,al,am)})}function l(ak,al){if(!D){P()}if(!al){al=0}var aj=zmStatus.PARSE_LINK_URL;if(al>0){aj=zmStatus.GET_LINK_URL}zm.getJSON(aj+"url="+encodeURIComponent(ak)+"&jsonpcallback=?",{dataType:"json"},function(am){if(am.error_code==2){zm.Boxy.alert("Link của bạn không hợp lệ","Thông báo",2000)}else{if(am.error_code==1||!am.data){if(al<zmStatus.LINK_RETRY-1){al++;setTimeout(function(){l(ak,al)},2000)}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau","Thông báo",2000);if(f==R){zmStatus.showLink()}else{zmStatus.showStatus(!W)}}}else{M(am)}}})}function P(){var aj="http://"+zm.config.hostImage+"/images";zm("#link-cont").html('<img class="thumb" rel="'+aj+'/nophoto.gif" src="'+aj+'/nophoto.gif" id="link-image" />			<div class="contRight">				<div class="linkTitle"><a class="black_link" id="link-title" tabindex="1" href=""></a><textarea rows="1" tabindex="2" id="link-title-input" style="display:none;"></textarea></div>				<div><a id="link-domain" href="#"></a></div>				<div class="linkDesc"><a id="link-desc" href=""></a><textarea style="display:none;" id="link-desc-input" rows="1" tabindex="2"></textarea></div>				<div class="linkinstimg" id="link-att"><span class="icofeed ficon_photo"></span><a href="#">Chèn ảnh</a></div>				<div id="link-att-input" style="display: none"><input class="attImg" value="http://" /><a class="delImg" href="#"></a></div>				<div class="clr"></div>				<div class="selImg">					<div id="link-direct" class="btnSel" style="">						<a class="pre" href="#"><img rel="pre" width="19" height="17" src="'+aj+'/blank.gif" /></a><a class="next" href="#"><img rel="next" width="19" height="17" src="'+aj+'/blank.gif" /></a><span class="selImgDesc">Chọn hình đại diện</span>					</div>					<div class="noThumb"><input id="link-off-image" type="checkbox" class="noThumbnail" /><label for="link-off-image">Không hiển thị hình thu nhỏ</label></div>				</div>			</div>			<br class="clr" />');ad();D=true}var G=function(){var al=this.value;if(zm("#link-image").attr("src")==al){return}if(/\.(gif|jpe?g|png)$/i.test(al)&&/^http:\/\/.+/i.test(al)){var ak=zm.inArray(al,a.images);if(ak==-1){var aj=new Image();aj.onload=y;aj.onerror=y;aj.src=al}else{zm("#link-image").attr("src",al);b=ak}}},y=function(){if(this.height>=zmStatus.LINKIMAGE_SIZE&&this.width>=zmStatus.LINKIMAGE_SIZE){zm("#link-image").attr("src",this.src);a.images.push(this.src);var aj=a.images.length;b=aj-1;aj>1&&z(true)}};function ad(){zm("#link-title").click(function(){zm(this).hide();zm("#link-title-input").show().focus();return false});zm("#link-title-input").blur(function(){if(!zm("#link-title").html()){return}var aj=zm(this);aj.hide();zm("#link-title").text(aj.val()).show()});zm("#link-desc").click(function(){zm(this).hide();zm("#link-desc-input").show().focus();return false});zm("#link-desc-input").blur(function(){if(!zm("#link-desc").html()){return}var aj=zm(this);aj.hide();zm("#link-desc").text(aj.val()).show()});zm("#link-att").click(function(){zm("#link-att").hide();zm("#link-att-input").show();return false});zm("#link-att-input input").focus(function(){if(this.value=="http://"){this.value=""}}).blur(function(){if(this.value==""){this.value="http://"}}).bind("paste",function(){var aj=this;setTimeout(function(){G.call(aj)},100)}).blur(G);zm("#link-att-input .delImg").click(function(){zm("#link-att-input").hide();zm("#link-att").show();return false});zm("#link-off-image").click(function(){if(zm("#link-off-image").attr("checked")){zm("#link-image").hide()}else{zm("#link-image").show()}});zm("#link-direct a.pre").click(function(){b--;if(b<0){b=zm.objectLength(a.images)-1}zm("#link-image").attr("src",a.images[b]);return false});zm("#link-direct a.next").click(function(){b++;if(b>=zm.objectLength(a.images)){b=0}zm("#link-image").attr("src",a.images[b]);return false})}function M(an){if(r==ag){return}zmStatus.reset();f=r;r=ag;a=an.data;U=an.token;b=-1;zm("#status-loading").hide();zm("#status-cont").show();zm("#link-cont").show();zm("#status-close").show();X&&zm("#status-arrow").show().css("left",X+"px");zm("#link-title").html(a.title);zm("#link-title-input").val(a.title);zm("#link-title-input")[a.title?"hide":"show"]();zm("#link-desc").html(a.description);zm("#link-desc-input").val(a.description);zm("#link-desc-input")[a.description?"hide":"show"]();zm("#txtStatus").val("").attr("class",s+" share-desc").css({height:"",color:""}).show().focus().blur();z(false);a.imgLoaded=0;var am=[];for(var al=0,aj;aj=a.images[al];al++){var ak=new Image();ak.onload=af;ak.onerror=af;ak.src=aj;am.push(aj)}a.images=am;a.numImgs=am.length}var af=function(){a.imgLoaded++;if(this.height<zmStatus.LINKIMAGE_SIZE||this.width<zmStatus.LINKIMAGE_SIZE){var aj=zm.inArray(this.src,a.images);a.images.splice(aj,1)}else{if(a.imgLoaded==1){zm("#link-image").attr("src",this.src)}}if(a.imgLoaded==a.numImgs){zm("#link-image").attr("src",a.images[0]);b=0;a.images.length>1&&z(true)}};function z(aj){var ak=aj?"":"default";zm("#link-direct .pre").css("cursor",ak);zm("#link-direct .next").css("cursor",ak)}function J(){ab++;if(ab>O.length-1){ab=0}zm("#rdsinput").text(O[ab].content).renderEmotions();if(ab>0){zm("#rdsback").removeClass("dback")}else{zm("#rdsback").addClass("dback")}}function t(){if(ab>-1&&ab<O.length-1){J()}else{if(!I){I=true;zm("#rdsinput").html('<img src="http://'+zm.config.hostImage+'/images/loading_small.gif" />');var aj="";if(T){aj="&tid=54"}zm.get("/rds/api/status/random?from=me&t="+new Date().getTime()+aj+"&vname="+zmConfig.viewerName,{dataType:"json"},function(al){if(al&&al.length>0){for(var ak=0,am;am=al[ak];ak++){if(!ac(am)){O.push(am)}}J()}I=false},function(){zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau","Thông báo",2000,{modal:false});I=false})}}}function ac(al){var am=al.id;for(var aj=0,ak;ak=O[aj];aj++){if(ak.id==am){return true}}return false}function F(){var aj=zmConfig.viewerId==zmConfig.ownerId?"bạn":('<a href="'+zmConfig.PROFILE_URL+"/"+zmConfig.ownerName+'">'+zmConfig.ownerFullName+"</a>");p=new zm.Boxy(zm.extend({content:'<p id="rdstitle" class="txtrds">Hãy chọn 1 câu ngẫu nhiên mà bạn thích để đăng lên tường nhà '+aj+'</p>			<div>				<div class="avt fl"><a href="#"><img src="'+zmConfig.viewerAva50+'" alt="" /></a></div>				<div class="rtrds">					<p class="f12 inputrds" id="rdsinput"></p>					<div style="margin-bottom:20px">						 <div class="contbtnrds">							<a class="btn_L8 fl" id="rdsrefresh" href="#"><em><span class="icords selother"></span>Chọn câu khác</em></a>							<a class="btn_L5 fl dback" id="rdsback" href="#"><em><span class="icords back"></span>Quay lại</em></a>							<a class="btn_L5 fl" id="rdssave" href="#"><em><span class="icords saverds"></span>Lưu</em></a>							<div class="clr"></div>						</div>						<div class="grey fr"><span class="ico-sp icothinkfast"></span><a href="/apps/rds"><strong>Nghĩ nhanh</strong></a></div>						<div class="clr"></div>					</div>				</div>				<div class="clr"></div>			</div>',title:"Nghĩ nhanh",okButton:"Đăng lên tường",cancelButton:"Bỏ qua",contentClass:"lbx_widlar",modal:true,onOk:function(){var ak=O[ab];if(ak){zm.post(zmStatus.POST_RDS_URL,{id:ak.id,status:ak.content,ownerName:zmConfig.ownerName,ownerId:zmConfig.ownerId},{dataType:"json"},function(al){p.hide();setTimeout(function(){window.location.reload()},1000)});zm("#rdsinput").text("")}}},aa()));zm("#rdsrefresh").click(function(){t();return false});zm("#rdsback").click(function(){if(ab>0){ab--;zm("#rdsinput").text(O[ab].content).renderEmotions();ab==0&&zm("#rdsback").addClass("dback")}return false});zm("#rdssave").click(function(){if(O[ab]){zm.post("/rds/api/status/mefav",{id:O[ab].id},{dataType:"json"},function(){zm.Boxy.alert("Đã lưu vào danh sách Ưa thích","Thông báo",2000,{zIndex:1})})}return false})}function ai(){E=new zm.Boxy(zm.extend({content:'<div class="hrscope_infoconfirm">				<div id="hrsc_confirm"></div>				<div id="hrsc_changebd"></div>				<div id="hrsc_publish">					<p class="textdesc save" style="display: none">Thông tin mà bạn vừa cung cấp đã được lưu, để chỉnh sửa lại <strong><a href="/pe/profile">nhấp vào đây</a></strong>.</p>					<p class="textdesc publ">Nếu thông tin của bạn và tử vi bên dưới chưa đúng, <strong><a href="/pe/profile">nhấp vào đây</a></strong> để chỉnh sửa</p>					<div class="hrscope_finalinfo">						<div class="hrscope_userinfo">							<a class="hrscope_useravt" href="#"><img border="0" src="'+zmConfig.viewerAva50+'" /></a>							<p class="user_birthday">Bạn sinh ngày <strong id="hrsc_birthday"></strong> là <strong id="hrsc_gender"></strong> - <strong id="hrsc_name"></strong></p>						</div>						<div class="clr"></div>					</div>				</div>			</div>			<div id="hrsc_detail" class="hrscope_detail">				<p class="hrscope_thumbnail">					<a title="" href="#" id="hrscimg"><img border="0" src="'+zmConfig.IMAGE_URL+'/v3/images/blank.gif" class="hrscthumb" /></a>					<a title="Xem tử vi" class="hrscope_appbtn" href="#" id="hrscimgtxt">Xem tử vi</a>				</p>				<div class="hrscope_text" id="hrscinfolist">				</div>				<div class="clr"></div>			</div>			<div class="bottom_btn" style="display:none;"><a title="Đăng lên tường" class="hrscope_posttowall" href="#" id="hrsc_submit">Đăng lên tường</a></div>',title:"Tử vi hôm nay của bạn",footer:false,contentClass:"lbx_widlar"},aa()));zm(E.getElement()).addClass("hrscope_boxy");zm("#hrsc_submit").click(A)}function x(){zm.post("/hs/api/mestatus/getzidac",{uname:zmConfig.ownerName},{dataType:"json"},function(am){if(am&&am.data){u=am.data.zidac.zidac_id;o(am.data);var ak=new Date(),al=ak.getYear(),aj=new Date(al<1900?al+1900:al,ak.getMonth(),ak.getDate()+1);zm.storage.put("zmstatus.hrsc."+zmConfig.viewerId,am.data,Math.floor((aj-ak)/1000))}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau","Thông báo",2000)}})}function o(ao){var aq=zm("#hrsc_confirm");if(ao.ckbitmap==0){if(aq.html()==""){var ak=zmConfig.viewerFullName;if(ak.length>30){ak=ak.substr(0,27)+"..."}aq.html('<p class="textdesc bgyellow">Chào <a href="'+zmConfig.PROFILE_URL+"/"+zmConfig.viewerName+'"><strong>'+ak+'</strong></a>, bạn vui lòng xác minh lại thông tin bên dưới của bạn</p>					<div class="hrscope_userinfo">						<a class="hrscope_useravt" href="#"><img border="0" src="'+zmConfig.viewerAva50+'" /></a>						<p class="user_birthday">Bạn sinh ngày <strong id="hrsc_birthday"></strong> là <strong id="hrsc_gender"></strong> - <strong id="hrsc_name2"></strong></p>					</div>					<div class="hrscope_checkbtn"><a title="Đúng" class="true_btn" href="#" id="hrsc_confirm_t">Đúng</a><a title="Sai" class="false_btn" href="#" id="hrsc_confirm_f">Sai</a></div>');zm("#hrsc_confirm_t").click(function(){var ar=zm("#hrsc_confirm_t");if(ar.attr("data-disable")!=1){ar.attr("data-disable",1);zm.post("/hs/api/mestatus/confirmzidac",{uname:zmConfig.viewerName},{dataType:"json"},function(at){zm("#hrsc_confirm_t").attr("data-disable",0);if(at.error==0){zm.storage.remove("zmstatus.hrsc."+zmConfig.viewerId);zm("#hrsc_confirm").hide();d()}else{zm.Boxy.alert(at.data,"Thông báo",2000)}},function(){zm("#hrsc_confirm_t").attr("data-disable",0);zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000)})}return false});zm("#hrsc_confirm_f").click(function(){zm("#hrsc_confirm").hide();V();zm.post("/hs/api/mestatus/retypezidac",{uname:zmConfig.viewerName});return false})}zm("#hrsc_name2").html(ao.zidac.zidac_name);aq.show();zm("#hrsc_publish").hide();zm("#hrsc_detail").addClass("false")}else{aq.hide();if(typeof Y=="boolean"){var am=zm("#hrsc_publish p.textdesc");if(Y){am.filter(".save").show();am.filter(".publ").hide();Y=false}else{am.filter(".save").hide();am.filter(".publ").show();Y=null}}d()}zm("#hrsc_changebd").hide();var aj=ao.zidac;zm("#hrsc_gender").html(aj.genderName);zm("#hrsc_birthday").html(aj.birthday);zm("#hrsc_name").html(aj.zidac_name);zm("#hrscimgtxt").attr("href","/apps/hrsc?params=/horoscope/index/index/gender/"+aj.gender+"/zidac_id/"+aj.zidac_id);zm("#hrscimg").attr("href","/apps/hrsc?params=/horoscope/index/index/gender/"+aj.gender+"/zidac_id/"+aj.zidac_id);zm("#hrscimg img").attr("class","hrscthumb thumb_"+aj.zidac_picname);var ap="";for(var al=0,an;an=ao.info[al];al++){ap+='<p class="hrscope_phead"><span class="hrscptext">'+an.nametype+'</span> <span class="icofam horoscope_'+an.points+'"></span></p>				<p>'+an.description+"</p>"}zm("#hrscinfolist").html(ap);E.show()}var A=function(){if(u){zm("#id_share_hrsc").hideTip();zm.post(zmStatus.POST_HRSC_URL,{zidac_id:u,uname:zmConfig.ownerName},{dataType:"json"},function(aj){if(aj.error==0&&aj.feedid){zmStatus.getFeedContent(aj.feedid);if(aj.isUpdatePoint){zmCommon.plusPoint("+6","status-cont",{offsetLeft:-20,offsetTop:-20})}else{zmCommon.fullPoint(3,"status-cont",{offsetTop:-3})}}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000)}E.hide()},function(){zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000);E.hide()});u=null}return false};function V(){var ao=zm("#hrsc_changebd");zm("#hrsc_detail").addClass("false");if(ao.html()!=""){ao.show();zm("#hrsc_updateinfo select").each(function(){zm(this).css("border-color","")});zm("#hrsc_formerr").hide();zm("#hrsc_formlabel").show();return}var al,aj='<option value="-1">Ngày</option>',ak='<option value="-1">Tháng</option>',an='<option value="-1">Năm</option>';for(al=1;al<=31;al++){aj+='<option value="'+al+'">'+al+"</option>"}for(al=1;al<=12;al++){ak+='<option value="'+al+'">'+al+"</option>"}var am=new Date().getFullYear();for(al=am;al>am-80;al--){an+='<option value="'+al+'">'+al+"</option>"}ao.html('<form id="hrsc_updateinfo" method="POST" action="/hs/api/mestatus/savedob">			<input type="hidden" name="uname" value="'+zmConfig.viewerName+'" />			<p id="hrsc_formlabel">Thông tin trước không đúng. Hãy cung cấp lại thông tin chính xác của bạn</p>			<p id="hrsc_formerr" class="red" style="display: none">Bạn chưa nhập đủ thông tin</p>			<div class="hrscope_userinfo">				<div class="hrscope_updateinfo">					<div class="hrscope_uform">						<label class="birthday_sel">Ngày sinh</label>						<span><select name="d">'+aj+'</select></span>						<span><select name="m">'+ak+'</select></span>						<span><select name="y">'+an+'</select></span>						<label class="sex_sel">Giới tính</label>						<span><select name="g"><option value="0">Nam</option><option value="1">Nữ</option></select></span>					</div>				</div>			</div>			<a id="hrsc_infosubmit" href="#" class="hrscope_saveinfobtn" title="Lưu lại">Lưu lại</a>		</form>').show();zm("#hrsc_updateinfo").ajaxSubmit({dataType:"json",beforeSubmit:function(ar){var aq=zm("#hrsc_infosubmit"),ap=true;if(aq.attr("data-disable")==1){return false}zm(ar).find("select").each(function(){if(this.value==-1){ap=false;zm(this).css("border-color","red")}else{zm(this).css("border-color","")}});ap&&aq.attr("data-disable",1);zm("#hrsc_formerr")[ap?"hide":"show"]();zm("#hrsc_formlabel")[ap?"show":"hide"]();return ap},success:function(ap){if(ap.error==0){zm.storage.remove("zmstatus.hrsc."+zmConfig.viewerId);Y=true;x()}else{zm.Boxy.alert(ap.data,"Thông báo",2000)}zm("#hrsc_infosubmit").attr("data-disable",0)},error:function(ap){zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000);zm("#hrsc_infosubmit").attr("data-disable",0)}});zm("#hrsc_infosubmit").click(function(){zm("#hrsc_updateinfo").submit();return false})}function d(){zm("#hrsc_publish").show().parent().addClass("finish");zm("#hrscinfolist").css("height","250px");zm("#hrsc_submit").parent().show();zm("#hrsc_detail").removeClass("false")}function N(){var ak=ak||[];ak.push(["_setAccount","UA-4718926-1"]);ak.push(["_setAllowLinker",true]);ak.push(["_setAllowHash",false]);ak.push(["_trackPageview"]);ak.push(["z._setAccount","UA-4695288-1"]);ak.push(["z._setDomainName",".zing.vn"]);ak.push(["z._setAllowLinker",true]);ak.push(["z._setAllowHash",false]);ak.push(["z._trackPageview"]);var aj=(("https:"==current_protocol)?"https://ssl.":"http://www.");zm.addScript(aj+"google-analytics.com/ga.js")}function aa(){return{}}function ah(){if(typeof zmTooltip!="undefined"){return zmTooltip.getShowingTip()}return null}return{POST_STATUS_URL:"/act/%to/index/updatestatus",PARSE_LINK_URL:"http://plink.apps.zing.vn/api/parse?",GET_LINK_URL:"http://plink.apps.zing.vn/api/getinfo?",POST_LINK_URL:"http://link.apps.zing.vn/lk/"+zmConfig.viewerName+"/ajax/handle?",GET_FPHOTOID_URL:"http://photo.apps.zing.vn/api/rest?method=getPhotoFeedId&",POST_RDS_URL:"/rds/api/status/mepost2",POST_HRSC_URL:"/hs/api/mestatus/pushfeed",GET_FEED_URL:"/f/"+zmConfig.viewerName+"/feed/detail-feed?feedid=",LINK_RETRY:10,PHOTO_RETRY:5,FEED_RETRY:11,LINKIMAGE_SIZE:80,defaultText:{0:zm("#txtStatus").val(),2:"Nói điều gì đó về hình ảnh này...",4:"Nói điều gì đó về link này..."},HRSC_DEFTEXT:["Viết cảm nhận...","Viết gì đó..."],POSTPHOTO_TITLE:["Đăng ảnh lên tường"],reset:function(){switch(r){case w:e=zm("#txtStatus").val();zm("#status-cont").removeClass("share-status");break;case h:zm("#photobox").hide();zm("#status-cont").show();zm("#status-close").hide();break;case Q:var aj=zm("#txtStatus");q=aj.val();c=null;zm("#photo-text").val("");zm("#photo-file").val("");zm("#photo-title").hide();zm("#photo-cont").hide();zmConfig.viewerId==zmConfig.ownerId&&zm("#photo-newalbum").hide();zm.removeData(aj[0],"autoresize.stop");zm("#status-close").hide();break;case R:zm("#link-input").hide();zm("#status-close").hide();zm("#txtStatus").show();a=null;break;case ae:zm("#status-cont").show();zm("#status-loading").hide();zm("#link-input-url").val("http://");break;case ag:zm("#link-cont").hide();zm("#status-close").hide();zm("#link-att").show();zm("#link-att-input").hide();zm("#link-off-image").attr("checked","");zm("#link-image").attr("src",zm("#link-image").attr("rel")).show();zm("#link-att-input input").val("http://");break}},getDefVal:function(){return this.defaultText[r]||null},showStatus:function(){if(r!=w){zmStatus.reset();f=r;r=w;var aj=zm("#txtStatus"),ak=zmStatus.getDefVal();if(e){aj.val(e)}else{aj.val(ak)}aj.attr("class",s).css("color",((!e||e==ak)?"":"#333")).change();zm("#status-cont").addClass("share-status");zm("#status-arrow").hide()}return false},showPhoto:function(){if(zmConfig.viewerId!=zmConfig.ownerId){v()}else{if(r!=h){zmStatus.reset();f=r;r=h;var aj=Math.floor(Math.random()*zmStatus.POSTPHOTO_TITLE.length);zm("#photo-post a").text(zmStatus.POSTPHOTO_TITLE[aj]);zm("#photobox").show();zm("#status-cont").hide();Z&&zm("#status-arrow").show().css("left",Z+"px");zm("#status-close").show()}}return false},showLink:function(){if(r!=R){zmStatus.reset();f=r;r=R;zm("#link-input").show();zm("#link-input-url").focus();zm("#txtStatus").css("color","").hide();X&&zm("#status-arrow").show().css("left",X+"px");zm("#status-close").show()}return false},showRds:function(aj){if(!p){F()}p.show();t();N();return false},showDefRds:function(){return zmStatus.showRds(0)},showNy:function(){return zmStatus.showRds(0)},showHrsc:function(){if(!E){ai()}u=null;if(ah()==2){zm(document).hideTip()}x();N();return false},showLoading:function(){if(r!=ae){zmStatus.reset();f=r;r=ae;f==2&&zm("#link-input").hide();zm("#status-cont").hide();zm("#status-loading").show()}},parseLink:function(){if(r!=w&&r!=R){return false}var aj=(r==R)?zm("#link-input-url").val():zm("#txtStatus").val();aj=zm.trim(aj);if(/^https?:\/\/.+/i.test(aj)){zmStatus.showLoading();l(aj)}else{if(r==R){zm.Boxy.alert("Link bạn nhập không hợp lệ","Thông báo",2000)}}return false},setStatus:function(ao,al,ar){var am="";if(ao!="del"){am=al||zm("#txtStatus").val();if(am==zmStatus.getDefVal()||zm.trim(am)==""){if(!(ar&&!ar.checkText)){zm.Boxy.alert("Bạn hãy nhập nội dung cần chia sẻ","Thông báo",2000)}return}}var ak={status:am,fromtracking:(ar&&ar.fromtracking)||this.status_type,signkey:zmConfig.signkey,time:zmConfig.time,timepost:zmConfig.time};if(ao=="del"){ak.type="del"}arguments.length==0&&zm("#txtStatus").attr("disabled","disabled").css("color","#e2e2e2").blur().hideTip();var ap=(ar&&ar.to)||zmConfig.ownerName,aj=zmStatus.POST_STATUS_URL.replace(/%to/g,ap),aq=function(au){e=null;if(au.status==1){if(au.action=="status"&&ao!="del"&&zmConfig.viewerName==zmConfig.ownerName){zm("#spStatus").html(au.value.status_msg);zm("#spStatusDate").html(au.date);zm("#delStatusId").show()}k(au.value.status_msg==""?0:1);if(!ao){if(au.action!="status"||zmConfig.viewerName==zmConfig.ownerName){typeof zmf!="undefined"&&zmf.crtf(au.templateInfo);var at=zm("#txtStatus");at.val()!=zmStatus.getDefVal()&&at.val("").attr("disabled","").css({height:"",color:"#333"}).focus()}}else{if(ao=="popup"){zm.Boxy.alert("Chia sẻ thành công","Thông báo")}}}else{if(ao=="del"){k(0)}else{if(au.content.length>0){zm.Boxy.alert(au.content,"Thông báo",null,i)}}}var av=ar&&ar.success;zm.isFunction(av)&&av(au);setTimeout(function(){if(ao=="del"&&ar&&au.isUpdatePoint){zmCommon.plusPoint("-12",ar.pointElement,ar)}else{if(au.action=="status"&&ao!="del"){var aw=ar&&ar.pointElement;if(au.isUpdatePoint){zmCommon.plusPoint("+6",aw||"status-cont",{offsetLeft:-20,offsetTop:-20})}else{zmCommon.fullPoint(0,aw||"status-cont",{offsetTop:-3})}}}},1000)},an=function(){var at=ar&&ar.error;zm.isFunction(at)&&at();zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau","Thông báo",2000,i)};zm.post(aj,ak,{dataType:"json",timeout:5000},aq,an)},postStatusHeader:function(){var aj=zm("#txtStatusHeader"),ak=zm.trim(aj.val());if(ak==aj.attr("rel")){aj.focus()}else{if(ak){aj.attr("disabled","disabled");zmStatus.setStatus("",ak,{to:zmConfig.viewerName,checkText:false,fromtracking:"header",pointElement:zm("#spStatusHeader").parent(),success:function(al){if(al.status==1&&al.action=="status"){zm("#spStatusHeader").html(al.value.status_msg);zm("#spStatusDateHeader").html(al.date);zm("#txtStatusHeader").val("").attr("disabled","")}}})}}return false},post:function(){switch(r){case w:zmStatus.setStatus();break;case Q:if(!zm("#photo-text").val()){zm.Boxy.alert("Bạn chưa chọn file","Thông báo",2000)}else{q=zm("#txtStatus").val();zm("#photo-desc").val((q==zmStatus.getDefVal())?"":q);zmXCall.register("photoUploaded",B,true);zm("#photo-form").submit();zmStatus.showLoading()}break;case ag:if(a){var ak=zm("#txtStatus").val();if(ak.length>500){zm.Boxy.alert("Thông tin chia sẻ link không được vượt quá 500 ký tự.","Thông báo",2000);break}var aj=zm("#link-image"),am=aj.attr("src"),al=zm.extend({},{obj:"link",act:"addLinkStatus",ver:4,title:zm("#link-title-input").val(),short_desc:zm("#link-desc-input").val(),tk:U,link_status:(ak==zmStatus.getDefVal())?"":ak,img_desc:(zm("#link-off-image").attr("checked")||am==aj.attr("rel"))?"":zm("#link-image").attr("src"),owner:zmConfig.ownerName,media_code:a.media_code,media_width:a.media_width,media_height:a.media_height});zmStatus.showLoading();zm.getJSON(zmStatus.POST_LINK_URL+zm.param(al)+"&jsonpcallback=?",{dataType:"json"},function(an){if(an.rs&&an.rs.feed_id){zmStatus.getFeedContent(an.rs.feed_id,zmStatus.showStatus)}})}break}return false},getFeedContent:function(aj,ak){j=0;H(aj,null,function(al){zmStatus.renderFeed(al,ak)})},renderFeed:function(aj,ak){if(aj&&aj.contentRender){zm("#sfstatus").prepend(aj.contentRender);typeof zmf!="undefined"&&zmf.binding(aj.feedIds,aj.commentIds,false)}zm.isFunction(ak)&&ak()},handle:function(){var aj=zm("#txtStatus");if(aj.size()<1){return}aj.focus(function(){var al=zm("#txtStatus"),am=al.val();if(am==zmStatus.getDefVal()){al.val("")}al.css("color",(r==w&&"#333")||"");if(ah()==1){zm(document).hideTip()}}).blur(function(){var al=zm("#txtStatus");if(al.val()==""){al.val(zmStatus.getDefVal());al.css("color","")}}).keypress(function(al){if(al.keyCode==13&&!al.shiftKey){zm("#status-share").click();return false}}).bind("paste",function(){W=true;setTimeout(zmStatus.parseLink,100)}).autoResize().tagFriend(aj.parent()[0]);zm("#photo-file").change(function(){var al=this.value;if(/\.(gif|jpe?g|png)$/i.test(al)){zm("#photo-text").val(al)}else{zm.Boxy.alert("Ảnh không hợp lệ, chỉ hỗ trợ GIF, PNG, JPG, JPEG","Thông báo")}});zm("#link-input-url").focus(function(){if(this.value=="http://"){this.value=""}}).blur(function(){if(this.value==""){this.value="http://"}});zm("#link-act").click(zmStatus.parseLink);zm("#emostatus").attachEmoButtons("",{beforeInsert:function(){if(this.value==zmStatus.getDefVal()){this.value=""}}});if(zmConfig.pageName=="profile"){zm("#photobox ul li").addClass("pageprofile")}zm("#id_share_photo").click(zmStatus.showPhoto);zm("#photo-post").click(v);zm("#id_share_link").click(zmStatus.showLink);zm("#id_share_rds").click(zmStatus.showDefRds);zm("#id_share_ny").click(zmStatus.showNy);zm("#id_share_hrsc").click(zmStatus.showHrsc);zm("#status-close").click(zmStatus.showStatus);zm("#status-share").click(zmStatus.post);zm("#delStatusId").click(function(){zm.Boxy.confirm("Bạn có muốn xóa trạng thái của mình không",function(){zmStatus.setStatus("del","",{pointElement:"status-cont",offsetLeft:-20,offsetTop:-20})},{title:"Xóa trạng thái",okButton:"Xóa",cancelButton:"Đóng"});return false});var ak=zm("#status_att").left();Z=zm("#id_share_photo").left()-ak+21;X=zm("#id_share_link").left()-ak+21;L=aj.attr("rel");s=aj.attr("class");zm("#hsendgift").click(function(){if(ah()==3){zm(document).hideTip()}})},showAll:function(ak){var aj=zm(ak.parentNode.parentNode);aj.children(".statusexphide").hide();aj.children(".statusexpshow").show();return false}}})();zm.ready(function(){zmStatus.handle();var b="hrscpop."+zmConfig.viewerId;if(zmConfig.pageName=="home"){if(zm.storage.get(b,true)!=1){zm.post("/hs/api/mestatus/ckpopup",{uname:zmConfig.viewerName},{dataType:"json"},function(e){if(e.error==0&&e.data==1){zmStatus.showHrsc()}zm.storage.put(b,1,3600,true)})}}zm("#txtStatusHeader").focus(function(){var e=zm(this);if(zm.trim(e.val())==e.attr("rel")){e.val("")}}).blur(function(){var e=zm(this);if(zm.trim(e.val())==""){e.val(e.attr("rel"))}}).keydown(function(f){if(f.keyCode==27){this.value=""}}).keypress(function(f){if(!f.shiftKey&&f.keyCode==13){return zmStatus.postStatusHeader()}});zm("#status-header-share").click(zmStatus.postStatusHeader);function d(f,e){zm("#"+f).roll({direction:1,display:1,start:22,end:e,before:function(){if(this instanceof zmCore){zm("#"+this.attr("id")+"_text").show();this.removeClass("nobg")}}})}function c(f,e){zm("#"+f).roll({direction:1,start:e,end:22,callback:function(){if(this instanceof zmCore){zm("#"+this.attr("id")+"_text").hide();this.addClass("nobg")}a=true}})}if(zm("#pcertst .txtcertified").size()>0){setTimeout(function(){c("pcert",136);c("pnocert",155)},5000);var a=false;zm("#pcertst").hover(function(){if(a){var e=zm(this).attr("rel").split("_");d(e[0],zm.intval(e[1]));a=false}},function(){var e=zm(this).attr("rel").split("_");c(e[0],zm.intval(e[1]))})}});